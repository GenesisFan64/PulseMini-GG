#======================================================================
# MS CHECKSUM FIXER
# 
# rom file, final size
#======================================================================

import sys
import os.path

#======================================================================
# -------------------------------------------------
# Settings
# -------------------------------------------------

DO_PADDING = True

#======================================================================
# -------------------------------------------------
# Init
# -------------------------------------------------

if os.path.exists(sys.argv[1]) == False:
	print("MSCHKSM: File not found")
	exit()
	
input_file = open(sys.argv[1],"r+b")
this_size = sys.argv[2]
working=True

#======================================================================
# -------------------------------------------------
# Start
# -------------------------------------------------

bc = int(this_size,16) - 0x10
input_file.seek(0x0000)

d = 0
while bc:
	a = int( ord(input_file.read(1)) ) & 0xFF
	d += a
	bc -= 1

input_file.seek(0x7FF0+0xA)
a = d >> 8 & 0xFF
b = d & 0xFF
input_file.write( bytes([b,a]) )
	
# ----------------------------
# End
# ----------------------------

input_file.close()  
